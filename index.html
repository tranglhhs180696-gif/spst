<!doctype html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0B1120" />
  <title>THE MARX SOURCE | T·∫≠p san Tri·∫øt h·ªçc K·ªπ thu·∫≠t s·ªë</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@700&family=Playfair+Display:ital,wght@0,700;1,600&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            bg: '#0B1120', surface: '#1e293b', primary: '#38bdf8', accent: '#f43f5e', text: '#e2e8f0',
            philosophy: { bg: '#F8F6F2', primary: '#1F3D2B' }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            serif: ['Playfair Display', 'serif'],
            code: ['JetBrains Mono', 'monospace'],
          }
        }
      }
    }
  </script>

  <style>
    [x-cloak] { display: none !important; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .perspective { perspective: 1000px; }
    .glass { background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }

    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.001ms !important;
        transition-duration: 0.001ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* Ensure visible focus for keyboard users */
    :where(button, a, [role="button"]) {
      outline: none;
    }

    /*
      Fix for overlapping Vietnamese diacritics / glyph collisions for very large hero titles:
      - set a safer line-height at big sizes
      - force font rendering settings that reduce glyph collisions / ligature surprises
    */
    .hero-title {
      line-height: 1.06;
      letter-spacing: -0.01em; /* small negative for visual tightness; tune if needed */
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
      font-kerning: normal;
      font-feature-settings: "liga" 0, "clig" 0, "calt" 0;
    }
    @media (min-width: 1024px) {
      .hero-title { line-height: 1.02; letter-spacing: -0.01em; }
    }
    @media (max-width: 640px) {
      .hero-title { line-height: 1.12; letter-spacing: 0; }
    }

    /* Small toast */
    #site-toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      z-index: 9999;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 13px;
      opacity: 0;
      transition: opacity .2s, transform .25s;
      pointer-events: none;
    }
    #site-toast.show { opacity: 1; transform: translateX(-50%) translateY(-6px); pointer-events: auto; }
  </style>
</head>
<body x-data="mainApp()" x-init="init()" :class="darkMode ? 'dark bg-bg text-text' : 'bg-philosophy-bg text-slate-900'"
      class="font-sans transition-colors duration-500 overflow-x-hidden"
      @keydown.escape.window="lightbox = false">

  <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:bg-white/90 focus:text-black p-2 rounded">B·ªè qua t·ªõi n·ªôi dung</a>

  <!-- LIGHTBOX -->
  <div x-show="lightbox" x-cloak
       @click.outside="lightbox = false"
       x-trap="lightbox"
       class="fixed inset-0 z-[200] bg-black/95 flex items-center justify-center p-4 transition-opacity duration-300"
       role="dialog" aria-modal="true" :aria-label="'Lightbox: ' + infographics[activeInfo].title">
    <button @click.stop="prevInfo()" aria-label="Previous" class="absolute left-6 top-1/2 -translate-y-1/2 z-50 p-3 rounded-full bg-white/10 text-white">‚Äπ</button>

    <img :src="infographics[activeInfo].url" :alt="infographics[activeInfo].title" loading="lazy"
         class="max-w-full max-h-full rounded-lg shadow-2xl border border-white/10">

    <button @click.stop="nextInfo()" aria-label="Next" class="absolute right-6 top-1/2 -translate-y-1/2 z-50 p-3 rounded-full bg-white/10 text-white">‚Ä∫</button>

    <div class="absolute bottom-10 text-center text-white bg-black/50 p-4 rounded-lg backdrop-blur-md">
      <h2 class="text-2xl font-serif mb-1" x-text="infographics[activeInfo].title"></h2>
      <p class="text-xs tracking-widest uppercase opacity-60" x-text="'ƒê·ªô ph√¢n gi·∫£i 4K ‚Ä¢ Ch∆∞∆°ng ' + infographics[activeInfo].chapter"></p>
    </div>
  </div>

  <!-- NAV -->
  <nav role="navigation" aria-label="Main navigation"
       class="fixed top-0 w-full z-[100] backdrop-blur-md border-b border-gray-200 dark:border-white/5 h-16 flex items-center justify-between px-6 lg:px-12 transition-colors duration-500">
    <div class="font-code text-xl font-bold tracking-tighter">
      <span class="text-primary">&lt;</span>E-MARX<span class="text-primary">/&gt;</span>
    </div>

    <div class="hidden md:flex gap-8 text-[10px] font-bold tracking-widest uppercase opacity-70">
      <a href="#hero" :class="activeSection === 'hero' ? 'text-primary' : ''" class="hover:text-primary transition focus-visible:ring-2 focus-visible:ring-primary rounded">Trang ch·ªß</a>
      <a href="#knowledge" :class="activeSection === 'knowledge' ? 'text-primary' : ''" class="hover:text-primary transition focus-visible:ring-2 focus-visible:ring-primary rounded">H·ªçc thu·∫≠t</a>
      <a href="#multimedia" :class="activeSection === 'multimedia' ? 'text-primary' : ''" class="hover:text-primary transition focus-visible:ring-2 focus-visible:ring-primary rounded">Multimedia</a>
      <a href="#quiz" :class="activeSection === 'quiz' ? 'text-accent' : ''" class="hover:text-accent transition focus-visible:ring-2 focus-visible:ring-accent rounded">Debug Quiz</a>
    </div>

    <div class="flex items-center gap-4">
      <button type="button" @click="darkMode = !darkMode" :aria-pressed="String(darkMode)"
              aria-label="Toggle dark mode"
              class="p-2 rounded-full border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-white/5 transition focus-visible:ring-2 focus-visible:ring-primary">
        <span x-text="darkMode ? '‚òÄÔ∏è' : 'üåô'"></span>
      </button>
      <a href="#quiz" class="px-4 py-2 bg-accent text-white rounded-full text-[10px] font-bold hover:scale-105 transition shadow-lg shadow-accent/30 focus-visible:ring-2 focus-visible:ring-accent">TEST NOW</a>
    </div>
  </nav>

  <main id="main" class="pt-16">
    <header id="hero" class="min-h-screen flex items-center justify-center relative pt-16">
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(56,189,248,0.1)_0%,transparent_100%)]"></div>
      <div class="container mx-auto px-6 text-center z-10">
        <span class="inline-block mb-4 px-3 py-1 rounded-full border border-accent text-accent text-xs font-bold tracking-widest animate-pulse uppercase italic">T·∫≠p san K·ªπ thu·∫≠t s·ªë - Nh√≥m 6 GD1822</span>

        <!-- apply hero-title class -->
        <h1 class="hero-title text-5xl sm:text-6xl md:text-8xl lg:text-9xl font-black mb-6 tracking-tighter uppercase" data-aos="zoom-in">
          M√É NGU·ªíN C·ª¶A <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-purple-400 to-accent">TH·ª∞C T·∫†I</span>
        </h1>

        <p class="text-base sm:text-lg md:text-2xl opacity-70 max-w-3xl mx-auto mb-10 font-serif italic" data-aos="fade-up">
          "Th·∫ø gi·ªõi kh√¥ng v·∫≠n ƒë·ªông ng·∫´u nhi√™n, n√≥ v·∫≠n ƒë·ªông theo nh·ªØng quy lu·∫≠t m√† b·∫°n c√≥ th·ªÉ gi·∫£i m√£."
        </p>

        <div class="flex flex-wrap gap-4 justify-center" data-aos="fade-up" data-aos-delay="200">
          <a href="#knowledge" class="px-8 sm:px-10 py-3 sm:py-4 bg-primary text-white font-bold rounded-xl hover:shadow-lg hover:shadow-primary/30 transition focus-visible:ring-2 focus-visible:ring-primary">T·∫¨P SAN</a>
          <a href="#multimedia" class="px-8 sm:px-10 py-3 sm:py-4 border border-gray-400 dark:border-gray-600 rounded-xl font-bold hover:bg-white hover:text-black transition uppercase focus-visible:ring-2 focus-visible:ring-accent">XEM INFOGRAPHIC</a>
        </div>
      </div>
    </header>

    <section class="py-16 bg-gray-100 dark:bg-surface/30 transition-colors duration-500">
      <div class="container mx-auto px-6 max-w-4xl text-center">
        <h2 class="font-serif text-3xl mb-6">L·ªùi c·ªßa Ban Bi√™n T·∫≠p</h2>
        <p class="text-lg leading-relaxed opacity-80">
          Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi M√É NGU·ªíN C·ª¶A TH·ª∞C T·∫†I ‚Äì n∆°i ki·∫øn th·ª©c nghi√™m t√∫c k·∫øt h·ª£p v·ªõi ng√¥n ng·ªØ ƒë·ªùi th∆∞·ªùng.
        </p>
      </div>
    </section>

    <section id="knowledge" class="py-24 container mx-auto px-6">
      <div class="flex justify-between items-end mb-16 border-b border-gray-200 dark:border-gray-800 pb-8">
        <h2 class="text-4xl md:text-6xl font-black">Ki·∫øn th·ª©c <br><span class="text-primary italic">H·ªçc thu·∫≠t</span></h2>
        <div class="flex gap-2">
          <button type="button" @click="contentMode = 'academic'"
                  :class="contentMode === 'academic' ? 'bg-primary text-white' : 'bg-gray-200 dark:bg-surface'"
                  class="px-6 py-2 rounded-lg text-xs font-bold transition focus-visible:ring-2 focus-visible:ring-primary"
                  :aria-pressed="contentMode === 'academic'">H√†n l√¢m</button>
          <button type="button" @click="contentMode = 'genz'"
                  :class="contentMode === 'genz' ? 'bg-accent text-white' : 'bg-gray-200 dark:bg-surface'"
                  class="px-6 py-2 rounded-lg text-xs font-bold transition focus-visible:ring-2 focus-visible:ring-accent"
                  :aria-pressed="contentMode === 'genz'">Gen Z</button>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
        <aside class="lg:col-span-3 space-y-4" aria-label="Module list">
          <template x-for="(chapter, index) in chapters" :key="index">
            <button type="button" @click="activeChapter = index"
                    :class="activeChapter === index ? 'border-primary bg-primary/10 text-primary' : 'border-transparent opacity-60'"
                    class="w-full text-left p-4 border-l-4 transition-all hover:pl-6 focus-visible:ring-2 focus-visible:ring-primary"
                    :aria-current="activeChapter === index ? 'true' : 'false'">
              <span class="block text-[10px] font-bold uppercase mb-1" x-text="chapter.shortTitle || 'MODULE ' + (index + 1)"></span>
              <span class="font-bold text-sm" x-text="chapter.title.split(':')[1] || chapter.title"></span>
            </button>
          </template>
        </aside>

        <div class="lg:col-span-9 bg-white dark:bg-surface p-8 md:p-12 rounded-3xl shadow-xl transition-all duration-500" data-aos="fade-left">
          <div x-show="contentMode === 'academic'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
            <div class="flex items-start justify-between gap-4">
              <h3 class="font-serif text-3xl mb-6 text-primary" x-text="chapters[activeChapter].title"></h3>
              <!-- TTS button for current chapter -->
              <button type="button" @click="speakChapter(activeChapter)" class="text-[12px] px-3 py-2 h-fit rounded bg-primary/10 text-primary" aria-label="Nghe ch∆∞∆°ng">Nghe</button>
            </div>
            <div class="prose dark:prose-invert max-w-none text-lg leading-relaxed space-y-6">
              <div x-html="chapters[activeChapter].academicBody"></div>

              <div class="mt-8 rounded-xl overflow-hidden shadow-lg border border-gray-200 dark:border-gray-700">
                <template x-if="activeChapter === 0">
                  <div>
                    <img src="https://images.unsplash.com/photo-1532012197267-da84d127e765?q=80&w=1200&auto=format&fit=crop"
                         alt="Ngu·ªìn g·ªëc nh·∫≠n th·ª©c v√† x√£ h·ªôi c·ªßa Tri·∫øt h·ªçc" loading="lazy"
                         class="w-full h-64 object-cover">
                    <p class="text-center text-xs text-gray-500 py-2 italic">S∆° ƒë·ªì: Ngu·ªìn g·ªëc nh·∫≠n th·ª©c v√† x√£ h·ªôi c·ªßa Tri·∫øt h·ªçc</p>
                  </div>
                </template>
                <template x-if="activeChapter === 1">
                  <div>
                    <img src="https://images.unsplash.com/photo-1507413245164-6160d8298b31?q=80&w=1200&auto=format&fit=crop"
                         alt="V·∫≠t ch·∫•t v√† √ù th·ª©c" loading="lazy"
                         class="w-full h-64 object-cover">
                    <p class="text-center text-xs text-gray-500 py-2 italic">S∆° ƒë·ªì: M·ªëi quan h·ªá bi·ªán ch·ª©ng V·∫≠t ch·∫•t - √ù th·ª©c</p>
                  </div>
                </template>
                <template x-if="activeChapter === 2">
                  <div>
                    <img src="https://images.unsplash.com/photo-1635070041078-e363dbe005cb?q=80&w=1200&auto=format&fit=crop"
                         alt="Quy lu·∫≠t L∆∞·ª£ng - Ch·∫•t" loading="lazy"
                         class="w-full h-64 object-cover">
                    <p class="text-center text-xs text-gray-500 py-2 italic">M√¥ h√¨nh: Quy lu·∫≠t L∆∞·ª£ng - Ch·∫•t v√† Ph·ªß ƒë·ªãnh c·ªßa Ph·ªß ƒë·ªãnh</p>
                  </div>
                </template>
                <template x-if="activeChapter === 4">
                  <div>
                    <img src="https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=1200&auto=format&fit=crop"
                         alt="C∆° s·ªü h·∫° t·∫ßng" loading="lazy"
                         class="w-full h-64 object-cover">
                    <p class="text-center text-xs text-gray-500 py-2 italic">S∆° ƒë·ªì: C∆° s·ªü h·∫° t·∫ßng & Ki·∫øn tr√∫c th∆∞·ª£ng t·∫ßng</p>
                  </div>
                </template>
              </div>
            </div>
          </div>

          <div x-show="contentMode === 'genz'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
            <h3 class="font-code text-3xl mb-6 text-accent uppercase" x-text="chapters[activeChapter].vibeTitle"></h3>
            <div class="p-8 bg-accent/5 rounded-2xl border-2 border-dashed border-accent/20">
              <p class="text-xl font-medium leading-relaxed" x-html="chapters[activeChapter].vibeBody"></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="multimedia" class="py-24 bg-gray-100 dark:bg-bg border-y border-gray-200 dark:border-white/5 transition-colors duration-500">
      <div class="container mx-auto px-6">
        <div class="text-center mb-16">
          <h2 class="text-4xl sm:text-5xl font-black mb-4">Multi <span class="text-accent italic">media</span></h2>
          <p class="opacity-60 uppercase tracking-widest text-xs font-bold">Podcast & Infographic 4K</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2 space-y-6">
            <div class="relative group aspect-video rounded-3xl overflow-hidden bg-black shadow-2xl cursor-zoom-in" @click="lightbox = true" role="button" tabindex="0" @keydown.enter="lightbox = true">
              <img :src="infographics[activeInfo].url" :alt="infographics[activeInfo].title" loading="lazy"
                   class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-700">
              <div class="absolute bottom-0 p-8 bg-gradient-to-t from-black to-transparent w-full">
                <h4 class="text-white text-2xl font-serif" x-text="infographics[activeInfo].title"></h4>
              </div>
            </div>

            <div class="flex gap-4 overflow-x-auto no-scrollbar pb-4">
              <template x-for="(img, idx) in infographics" :key="idx">
                <button type="button" @click="activeInfo = idx" :aria-pressed="activeInfo === idx"
                        :aria-label="'Xem infographic ' + (idx + 1) + ': ' + img.title"
                        class="w-32 aspect-video rounded-lg overflow-hidden border-2 flex-shrink-0 transition focus-visible:ring-2 focus-visible:ring-primary"
                        :class="activeInfo === idx ? 'border-primary' : 'border-transparent opacity-50'">
                  <img :src="img.url" :alt="img.title" loading="lazy" class="w-full h-full object-cover">
                </button>
              </template>
            </div>
          </div>

          <aside class="bg-philosophy-primary text-white p-8 rounded-3xl shadow-xl flex flex-col justify-between" aria-label="Podcast panel">
            <div>
              <span class="text-xs font-bold tracking-widest opacity-60 uppercase">PODCAST S·ªê 01</span>
              <h3 class="text-2xl sm:text-3xl font-serif mt-2 mb-6">Tri·∫øt h·ªçc & Deadline</h3>
              <div class="flex items-center gap-4 p-4 bg-white/10 rounded-2xl">
                <button type="button" @click="playing = !playing" aria-label="Play or pause podcast"
                        class="w-12 h-12 bg-accent rounded-full flex items-center justify-center hover:scale-110 transition focus-visible:ring-2 focus-visible:ring-accent">
                  <span x-show="!playing">‚ñ∂</span><span x-show="playing">‚è∏</span>
                </button>
                <div class="flex-1">
                  <div class="h-1 bg-white/20 w-full rounded-full">
                    <div class="h-full bg-accent" :style="playing ? 'width: 45%' : 'width: 0%'" aria-hidden="true"></div>
                  </div>
                  <div class="flex justify-between text-[10px] mt-1 opacity-60"><span>01:42</span><span>03:45</span></div>
                </div>
              </div>
            </div>
            <p class="text-sm opacity-70 italic mt-6 border-l-2 border-accent pl-4">"Khi quan h·ªá s·∫£n xu·∫•t c·ªßa m·ªôt d·ª± √°n kh·ªüi nghi·ªáp va ch·∫°m v·ªõi l·ª±c l∆∞·ª£ng s·∫£n xu·∫•t..."</p>
          </aside>
        </div>
      </div>
    </section>

    <section id="quiz" class="py-24 container mx-auto px-6 max-w-3xl" x-data="quizApp()">
      <div class="bg-white dark:bg-surface p-8 sm:p-10 rounded-[2rem] sm:rounded-[3rem] shadow-2xl text-center border border-gray-200 dark:border-white/5 transition-all duration-500">
        <h2 class="text-3xl sm:text-4xl font-black mb-6 sm:mb-8 uppercase">Ki·ªÉm tra <span class="text-accent italic">Ki·∫øn th·ª©c</span></h2>

        <div x-show="!started && !finished">
          <p class="mb-6 sm:mb-10 opacity-70">B·∫°n l√† "Nh√† bi·ªán ch·ª©ng" hay "T·∫•m chi·∫øu m·ªõi"?</p>
          <button type="button" @click="start()" class="px-8 sm:px-12 py-3 sm:py-4 bg-accent text-white font-bold rounded-2xl hover:scale-105 transition shadow-lg shadow-accent/30 focus-visible:ring-2 focus-visible:ring-accent">B·∫ÆT ƒê·∫¶U</button>
        </div>

        <div x-show="started && !finished">
          <div class="flex justify-between items-center mb-6 sm:mb-8 font-code text-[10px] font-bold uppercase tracking-widest text-gray-500">
            <span class="text-primary" x-text="'C√¢u h·ªèi ' + (currentQ + 1) + '/' + questions.length"></span>
            <span class="text-accent" x-text="'ƒêi·ªÉm: ' + score" aria-live="polite"></span>
          </div>

          <h3 class="text-xl sm:text-2xl font-bold mb-4 leading-tight min-h-[80px]" x-text="questions[currentQ].q"></h3>

          <div class="grid gap-4">
            <template x-for="(opt, i) in questions[currentQ].opts" :key="i">
              <button type="button" @click="answer(i)"
                      :class="selected === i ? (lastAnsweredCorrect ? 'border-green-400 bg-green-50' : 'border-red-400 bg-red-50') : 'border-gray-200 dark:border-white/10'"
                      class="w-full p-4 text-left rounded-xl border hover:border-primary hover:bg-primary/5 transition flex items-center gap-4 group focus-visible:ring-2 focus-visible:ring-primary">
                <span class="w-8 h-8 rounded-full border border-gray-400 group-hover:border-primary flex items-center justify-center text-[10px] font-bold" x-text="String.fromCharCode(65 + i)"></span>
                <span x-text="opt"></span>
              </button>
            </template>
          </div>

          <div class="flex gap-3 justify-center mt-6">
            <button type="button" @click="hint()" class="px-4 py-2 rounded-lg border text-xs bg-gray-50 dark:bg-black/20">G·ª£i √Ω</button>
            <button type="button" @click="nextQuestion()" class="px-4 py-2 rounded-lg bg-primary text-white">B·ªè qua / Ti·∫øp</button>
          </div>
        </div>

        <div x-show="finished">
          <div class="text-6xl sm:text-7xl mb-6 animate-bounce">üëë</div>
          <h3 class="text-2xl sm:text-3xl font-bold mb-4 uppercase">Ho√†n th√†nh!</h3>
          <p class="text-primary font-bold text-xl sm:text-2xl mb-6" x-text="'K·∫øt qu·∫£: ' + score + '/' + questions.length"></p>
          <button type="button" @click="reset()" class="px-6 py-2 border border-gray-300 dark:border-white/20 rounded-xl text-xs font-bold hover:bg-gray-100 dark:hover:bg-white/5 transition uppercase focus-visible:ring-2 focus-visible:ring-primary">L√†m l·∫°i</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Academic toolbox (unchanged mostly) -->
  <div x-data="academicToolkit()" class="fixed bottom-8 right-8 z-[150] flex flex-col items-end gap-3" aria-label="Academic toolbox">
    <div x-show="openTab === 'glossary'" x-transition x-cloak class="w-72 glass p-5 rounded-2xl shadow-2xl mb-2 overflow-hidden bg-white/90 dark:bg-surface/90 backdrop-blur-xl border border-white/20">
      <h4 class="text-[10px] font-bold text-primary mb-3 uppercase tracking-widest">T·ª´ ƒëi·ªÉn Tri·∫øt h·ªçc</h4>
      <input type="text" x-model="searchQuery" placeholder="T√¨m thu·∫≠t ng·ªØ..." aria-label="T√¨m thu·∫≠t ng·ªØ"
             class="w-full bg-gray-100 dark:bg-black/20 p-2 rounded-lg text-xs mb-3 border border-gray-200 dark:border-white/10 focus:ring-1 focus:ring-primary outline-none">
      <div class="max-h-48 overflow-y-auto space-y-3 no-scrollbar text-left">
        <template x-for="item in filteredGlossary" :key="item.term">
          <div class="border-b border-gray-200 dark:border-white/5 pb-2 last:border-0">
            <p class="text-xs font-bold text-accent" x-text="item.term"></p>
            <p class="text-[10px] opacity-70 italic" x-text="item.define"></p>
          </div>
        </template>
      </div>
    </div>

    <div x-show="openTab === 'citation'" x-transition x-cloak class="w-72 bg-white/90 dark:bg-surface/90 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-5 mb-2">
      <h4 class="text-[10px] font-bold text-accent mb-3 uppercase tracking-widest">Tr√≠ch d·∫´n nhanh</h4>
      <div class="bg-gray-100 dark:bg-black/20 p-3 rounded-lg text-[10px] font-mono break-words mb-3 text-left select-all" id="citation-text">
        Nh√≥m 6 (2026), "THE MARX SOURCE: M√£ ngu·ªìn th·ª±c t·∫°i", T·∫≠p san Tri·∫øt h·ªçc GD1822, FPT University.
      </div>
      <button type="button" @click="copyCitation()" class="w-full py-2 bg-accent text-white text-[10px] font-bold rounded-lg hover:opacity-90 transition uppercase focus-visible:ring-2 focus-visible:ring-accent">Copy Clipboard</button>
    </div>

    <div x-show="openTab === 'bookmark'" x-transition x-cloak class="w-72 bg-white/90 dark:bg-surface/90 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-5 mb-2">
      <h4 class="text-[10px] font-bold text-gray-500 mb-3 uppercase tracking-widest">ƒê√£ l∆∞u</h4>
      <div class="space-y-2 text-left">
        <template x-if="bookmarks.length === 0">
          <p class="text-[10px] opacity-50 italic">Ch∆∞a c√≥ b√†i l∆∞u n√†o...</p>
        </template>
        <template x-for="bm in bookmarks">
          <div class="flex justify-between items-center text-[10px] bg-gray-100 dark:bg-black/20 p-2 rounded border border-transparent dark:border-white/5">
            <span x-text="bm" class="truncate max-w-[80%]"></span>
            <button type="button" @click="removeBookmark(bm)" class="text-accent hover:text-red-600" aria-label="X√≥a bookmark">‚úï</button>
          </div>
        </template>
      </div>
    </div>

    <div class="flex flex-col gap-2">
      <button type="button" @click="toggleTab('glossary')" :class="openTab === 'glossary' ? 'bg-primary text-white scale-110' : 'bg-white dark:bg-surface text-gray-600 dark:text-gray-300'" class="w-10 h-10 rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 border border-gray-200 dark:border-white/10" aria-label="T·ª´ ƒëi·ªÉn">
        <span class="text-sm">üìñ</span>
      </button>
      <button type="button" @click="toggleTab('citation')" :class="openTab === 'citation' ? 'bg-accent text-white scale-110' : 'bg-white dark:bg-surface text-gray-600 dark:text-gray-300'" class="w-10 h-10 rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 border border-gray-200 dark:border-white/10" aria-label="Tr√≠ch d·∫´n nhanh">
        <span class="text-sm">üìú</span>
      </button>
      <button type="button" @click="addBookmark()" class="w-10 h-10 bg-white dark:bg-surface text-gray-600 dark:text-gray-300 rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 border border-gray-200 dark:border-white/10" aria-label="L∆∞u b√†i">
        <span class="text-sm">üîñ</span>
      </button>
      <button type="button" @click="openTab = openTab ? '' : 'main'" class="w-14 h-14 bg-primary text-white rounded-full shadow-xl shadow-primary/30 flex items-center justify-center text-2xl transition-transform duration-300 hover:rotate-90 focus-visible:ring-2 focus-visible:ring-primary" aria-label="M·ªü c√¥ng c·ª•">
        <span x-text="openTab ? '‚úï' : '‚öôÔ∏è'"></span>
      </button>
    </div>
  </div>

  <footer class="py-12 border-t border-gray-200 dark:border-white/5 text-center text-[10px] opacity-50 tracking-widest uppercase font-bold transition-colors duration-500">
    <p>¬© 2026 THE MARX SOURCE | FPT UNIVERSITY STUDENT PROJECT</p>
    <p class="mt-2 text-primary italic underline underline-offset-4">Ki·∫øn th·ª©c chu·∫©n ‚Ä¢ S√°ng t·∫°o Gen Z</p>
  </footer>

  <!-- toast element -->
  <div id="site-toast" role="status" aria-live="polite"></div>

  <script>
    function mainApp(){
      return {
        darkMode: true,
        activeChapter: 0,
        contentMode: 'academic',
        activeInfo: 0,
        lightbox: false,
        playing: false,
        infographics: [
          { title: "Bi·ªán ch·ª©ng gi·ªØa L∆∞·ª£ng v√† Ch·∫•t", chapter: "2", url: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?auto=format&fit=crop&w=1600&q=90" },
          { title: "H·ªá th·ªëng x√£ h·ªôi", chapter: "5", url: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&w=1600&q=90" }
        ],
        chapters: [ /* ... same chapters as your original ... */ ],
        // init called via x-init on body
        init() {
          this.initScrollSpy();
          this.initLightboxKeyboard();
        },
        initScrollSpy() {
          const sections = ['hero','knowledge','multimedia','quiz'];
          const obs = new IntersectionObserver(entries => {
            entries.forEach(e=>{
              if(e.isIntersecting) {
                this.activeSection = e.target.id;
              }
            });
          }, { threshold: 0.45 });
          sections.forEach(id=>{
            const el = document.getElementById(id);
            if(el) obs.observe(el);
          });
        },
        initLightboxKeyboard() {
          window.addEventListener('keydown', (ev) => {
            if(!this.lightbox) return;
            if(ev.key === 'ArrowRight') { this.nextInfo(); }
            if(ev.key === 'ArrowLeft') { this.prevInfo(); }
          });
        },
        nextInfo() {
          this.activeInfo = (this.activeInfo + 1) % this.infographics.length;
        },
        prevInfo() {
          this.activeInfo = (this.activeInfo - 1 + this.infographics.length) % this.infographics.length;
        },
        speakChapter(idx) {
          const chap = this.chapters[idx];
          if(!window.speechSynthesis) {
            showToast('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªçc.');
            return;
          }
          // Build a short summary to speak (strip HTML tags)
          const tmp = document.createElement('div');
          tmp.innerHTML = chap.academicBody || chap.vibeBody || '';
          const text = (chap.title + '. ' + tmp.innerText).slice(0,1500); // limit
          const utter = new SpeechSynthesisUtterance(text);
          utter.rate = 0.95;
          utter.lang = 'vi-VN';
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(utter);
          showToast('ƒêang ƒë·ªçc n·ªôi dung...');
        }
      }
    }

    /* QUIZ APP */
    function quizApp(){
      return {
        started: false, finished: false, currentQ: 0, score: 0,
        selected: null,
        lastAnsweredCorrect: false,
        questions: [
          { q: "Theo CNDV Bi·ªán ch·ª©ng, y·∫øu t·ªë n√†o quy·∫øt ƒë·ªãnh s·ª± h√¨nh th√†nh √Ω th·ª©c?", opts: ["Th·∫ßn linh","V·∫≠t ch·∫•t","√ù ni·ªám tuy·ªát ƒë·ªëi","Ng·∫´u nhi√™n"], ans: 1 },
          { q: "Mu·ªën thay ƒë·ªïi v·ªÅ Ch·∫•t, ch√∫ng ta c·∫ßn l√†m g√¨ v·ªõi L∆∞·ª£ng?", opts: ["Gi·ªØ nguy√™n","T√≠ch l≈©y ƒë·ªß ƒë·∫øn ƒêi·ªÉm n√∫t","Gi·∫£m b·ªõt ƒëi","Thay ƒë·ªïi ƒë·ªôt ng·ªôt"], ans: 1 },
          { q: "B·ªánh 'T·∫£ khuynh' trong nh·∫≠n th·ª©c v√† h√†nh ƒë·ªông l√† g√¨?", opts: ["B·∫£o th·ªß, tr√¨ tr·ªá","N√¥n n√≥ng, ƒë·ªët ch√°y giai ƒëo·∫°n","Th·ª±c t·∫ø, kh√°ch quan","Tr√¥ng ch·ªù ·ª∑ l·∫°i"], ans: 1 },
          { q: "Theo L√™nin, v·∫≠t ch·∫•t l√†...?", opts: ["C√°i do √Ω th·ª©c ƒë·∫ª ra","Th·ª±c t·∫°i kh√°ch quan","Ph·ª©c h·ª£p c√°c c·∫£m gi√°c","Nguy√™n t·ª≠"], ans: 1 },
          { q: "Y·∫øu t·ªë ƒë·ªông nh·∫•t, c√°ch m·∫°ng nh·∫•t trong L·ª±c l∆∞·ª£ng s·∫£n xu·∫•t l√†?", opts: ["C√¥ng c·ª• lao ƒë·ªông","Ng∆∞·ªùi lao ƒë·ªông","ƒê·ªëi t∆∞·ª£ng lao ƒë·ªông","Khoa h·ªçc"], ans: 0 },
          { q: "Y·∫øu t·ªë ƒë√≥ng vai tr√≤ QUAN TR·ªåNG NH·∫§T trong L·ª±c l∆∞·ª£ng s·∫£n xu·∫•t l√†?", opts: ["C√¥ng c·ª• lao ƒë·ªông","Ng∆∞·ªùi lao ƒë·ªông","T∆∞ li·ªáu s·∫£n xu·∫•t","Khoa h·ªçc"], ans: 1 },
          { q: "Ngu·ªìn g·ªëc X√É H·ªòI tr·ª±c ti·∫øp h√¨nh th√†nh n√™n √Ω th·ª©c l√†?", opts: ["B·ªô n√£o ng∆∞·ªùi","Th·∫ø gi·ªõi kh√°ch quan","Lao ƒë·ªông v√† Ng√¥n ng·ªØ","Gen di truy·ªÅn"], ans: 2 },
          { q: "M·ªëi li√™n h·ªá ph·ªï bi·∫øn ƒë√≤i h·ªèi ch√∫ng ta ph·∫£i c√≥ quan ƒëi·ªÉm g√¨?", opts: ["Quan ƒëi·ªÉm to√†n di·ªán","Quan ƒëi·ªÉm phi·∫øn di·ªán","Quan ƒëi·ªÉm chi·∫øt trung","Quan ƒëi·ªÉm ng·ª•y bi·ªán"], ans: 0 },
          { q: "Ph·ªß ƒë·ªãnh bi·ªán ch·ª©ng c√≥ ƒë·∫∑c ƒëi·ªÉm g√¨ n·ªïi b·∫≠t?", opts: ["X√≥a b·ªè ho√†n to√†n c√°i c≈©","K·∫ø th·ª´a h·∫°t nh√¢n h·ª£p l√Ω c·ªßa c√°i c≈©","L·∫∑p l·∫°i y nguy√™n c√°i c≈©","Ph·ªß ƒë·ªãnh s·∫°ch tr∆°n"], ans: 1 },
          { q: "Kho·∫£ng gi·ªõi h·∫°n m√† L∆∞·ª£ng ƒë·ªïi nh∆∞ng Ch·∫•t ch∆∞a ƒë·ªïi g·ªçi l√† g√¨?", opts: ["ƒêi·ªÉm n√∫t","B∆∞·ªõc nh·∫£y","ƒê·ªô","Ph·ªß ƒë·ªãnh"], ans: 2 },
          { q: "S·ª± t√°c ƒë·ªông c·ªßa √ù th·ª©c ƒë·ªëi v·ªõi V·∫≠t ch·∫•t di·ªÖn ra th√¥ng qua?", opts: ["Ho·∫°t ƒë·ªông th·ª±c ti·ªÖn","Suy nghƒ© trong ƒë·∫ßu","L·ªùi n√≥i su√¥ng","∆Ø·ªõc m∆°"], ans: 0 }
        ],
        start() {
          this.started = true;
          this.loadState();
          showToast('Quiz b·∫Øt ƒë·∫ßu. Ch√∫c b·∫°n may m·∫Øn!');
        },
        answer(i) {
          // prevent double answering same question
          if(this.selected !== null) return;
          this.selected = i;
          const correct = (i === this.questions[this.currentQ].ans);
          this.lastAnsweredCorrect = correct;
          if(correct) { this.score++; }
          // visual feedback for 700ms then advance
          setTimeout(()=>{
            this.selected = null;
            this.lastAnsweredCorrect = false;
            if(this.currentQ < this.questions.length - 1) {
              this.currentQ++;
            } else {
              this.finished = true;
            }
            this.saveState();
          }, 700);
          this.saveState();
        },
        nextQuestion() {
          // allow skipping
          if(this.currentQ < this.questions.length - 1) {
            this.currentQ++;
            this.saveState();
          } else {
            this.finished = true;
            this.saveState();
          }
        },
        hint() {
          const ansIdx = this.questions[this.currentQ].ans;
          const letter = String.fromCharCode(65 + ansIdx);
          showToast('G·ª£i √Ω: ƒê√°p √°n c√≥ ch·ªØ c√°i ' + letter);
        },
        reset() {
          this.started = this.finished = false;
          this.currentQ = this.score = 0;
          this.selected = null;
          this.lastAnsweredCorrect = false;
          localStorage.removeItem('marx_quiz');
        },
        saveState() {
          const state = { started: this.started, finished: this.finished, currentQ: this.currentQ, score: this.score };
          localStorage.setItem('marx_quiz', JSON.stringify(state));
        },
        loadState() {
          const s = JSON.parse(localStorage.getItem('marx_quiz') || 'null');
          if(s && s.started) {
            this.started = s.started;
            this.finished = s.finished;
            this.currentQ = s.currentQ;
            this.score = s.score;
            showToast('Ti·∫øp t·ª•c ti·∫øn ƒë·ªô quiz tr∆∞·ªõc ƒë√≥.');
          }
        }
      }
    }

    /* ACADEMIC TOOLKIT */
    function academicToolkit() {
      return {
        openTab: '',
        searchQuery: '',
        bookmarks: JSON.parse(localStorage.getItem('marx_bookmarks') || '[]'),
        glossary: [
          { term: 'Bi·ªán ch·ª©ng', define: 'M·ªëi li√™n h·ªá, s·ª± v·∫≠n ƒë·ªông v√† ph√°t tri·ªÉn kh√¥ng ng·ª´ng.' },
          { term: 'Th·ª±c t·∫°i kh√°ch quan', define: 'Nh·ªØng th·ª© t·ªìn t·∫°i ngo√†i √Ω th·ª©c, kh√¥ng ph·ª• thu·ªôc con ng∆∞·ªùi.' },
          { term: 'Ph·ªß ƒë·ªãnh bi·ªán ch·ª©ng', define: 'S·ª± thay th·∫ø c√°i c≈© b·∫±ng c√°i m·ªõi nh∆∞ng c√≥ k·∫ø th·ª´a.' },
          { term: 'ƒêi·ªÉm n√∫t', define: 'Th·ªùi ƒëi·ªÉm m√† s·ª± t√≠ch l≈©y v·ªÅ l∆∞·ª£ng ƒë·ªß ƒë·ªÉ thay ƒë·ªïi v·ªÅ ch·∫•t.' },
          { term: 'H√¨nh th√°i KT-XH', define: 'X√£ h·ªôi ·ªü m·ªôt giai ƒëo·∫°n l·ªãch s·ª≠ nhÔøΩÔøΩt ƒë·ªãnh v·ªõi ki·ªÉu quan h·ªá s·∫£n xu·∫•t ƒë·∫∑c tr∆∞ng.' }
        ],
        get filteredGlossary() {
          return this.glossary.filter(i => i.term.toLowerCase().includes(this.searchQuery.toLowerCase()));
        },
        toggleTab(tab) {
          this.openTab = this.openTab === tab ? '' : tab;
        },
        copyCitation() {
          const text = document.getElementById('citation-text').innerText;
          navigator.clipboard.writeText(text).then(()=> showToast('ƒê√£ sao ch√©p tr√≠ch d·∫´n chu·∫©n h·ªçc thu·∫≠t!'));
        },
        addBookmark() {
          const currentTitle = document.title;
          if (!this.bookmarks.includes(currentTitle)) {
            this.bookmarks.push(currentTitle);
            localStorage.setItem('marx_bookmarks', JSON.stringify(this.bookmarks));
            showToast('ƒê√£ l∆∞u b√†i vi·∫øt n√†y!');
          } else {
            showToast('B√†i vi·∫øt ƒë√£ ƒë∆∞·ª£c l∆∞u tr∆∞·ªõc ƒë√≥.');
          }
          this.openTab = 'bookmark';
        },
        removeBookmark(bm) {
          this.bookmarks = this.bookmarks.filter(i => i !== bm);
          localStorage.setItem('marx_bookmarks', JSON.stringify(this.bookmarks));
        }
      }
    }

    /* Small toast util (global) */
    function showToast(msg, ms = 1800) {
      const el = document.getElementById('site-toast');
      if(!el) return alert(msg);
      el.innerText = msg;
      el.classList.add('show');
      clearTimeout(window._siteToastTimer);
      window._siteToastTimer = setTimeout(()=> {
        el.classList.remove('show');
      }, ms);
    }

    AOS.init();
  </script>
</body>
</html>
